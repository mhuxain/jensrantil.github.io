<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="http://jensrantil.github.io/theme/css/style.css">
	<!--<link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">-->
	<!--<script src="/theme/js/less.js" type="text/javascript"></script>-->
	<link rel="stylesheet" type="text/css" href="http://jensrantil.github.io/theme/css/pygments.css">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>

	<link href="http://jensrantil.github.io/" type="application/atom+xml" rel="alternate" title="Jens Rantil's Hideout ATOM Feed" />
	
	
			<title>Jens Rantil's Hideout</title>
		<meta charset="utf-8" />
	</head>
<body>
	<section id="sidebar">
		<figure id="user_logo">
            <a href="http://jensrantil.github.io"><div class="logo">&nbsp;</div></a>
		</figure>

		<div class="user_meta">
            <h1 id="user"><a href="http://jensrantil.github.io" class="">Jens Rantil</a></h1>
			<h2></h2>
						<p class="bio">Swedish/English, fullstack software engineer (<a href="http://www.tinkapp.com" target="_blank">@Tink</a>), <a href="http://www.lth.se/english/education/programmes/master_engineering/engineering_mathematics/">MSc in Engineering Mathematics</a>, traveller, nerd, juggler, guitarist, african drum player. Inspired Swede.</p>
						<ul>
																			<li><a href="http://jensrantil.github.io/pages/about-jens.html">About Jens</a></li>
																		<li><a href="http://www.twitter.com/JensRantil">Twitter</a></li>
									<li><a href="http://www.github.com/JensRantil">Github</a></li>
									<li><a href="http://www.linkedin.com/in/jensrantil">LinkedIn</a></li>
							</ul>
		</div>
		<footer>
			<address>
				Powered by <a href="http://pelican.notmyidea.org/">Pelican</a>,
		                theme by <a href="https://github.com/wting/pelican-svbtle">wting</a>.
			</address>
		</footer>
	</section>

	<section id="posts">
			<header>
		<h1>Jens Rantil's blog</h1>
		<h3>Posted Thu 22 August 2013</h3>
	</header>
	<article>
		<h1 id="title">
			<a href="http://jensrantil.github.io/javas-missing-optional-keyword-and-the-issues-of-null.html" rel="bookmark"
				title="Permalink to Java's missing optional keyword and the issues of null">Java's missing optional keyword and the issues of null</a>
		</h1>
		<p>One of my pet peaves when it comes to the Java programming languages [1]
is that it does not do enough <a class="reference external" href="https://en.wikipedia.org/wiki/Type_safety">type safety</a>. The issue is, simply, that
programmers tend to believe that Java infers more safety than it
actually does. The biggest reason for this can be summarized in one
word; <tt class="docutils literal">null</tt>.</p>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Can be replaced by most other statically typed language; such as
C, C++.</td></tr>
</tbody>
</table>
<p>Let's face it, we've all experienced a <tt class="docutils literal">NullPointerException</tt> or two.
Why? Because we focus so much on which variable type to use. This makes
us tend to forget the simple fact that the variable might not have a
value at all; It can be <tt class="docutils literal">null</tt>.</p>
<p>Let's stop for a moment and think; In general, how many times should a
variables and parameters be nullable vs. non-nullable? I'm not looking
for an exact number here, but I'm sure you agree that most of your
method parameters are expected to be non-null. Heck, they need that
parameter to do what they are expected to execute. Still, they are
nullable.</p>
<p>This is interesting, because most Java code I've seen goes against the
common notion of requiring a parameter (or variable). I see two gaps:</p>
<ul class="simple">
<li>the gap between the number of non-null expected parameters and the number of times they are actually documented to be non-nullable.</li>
<li>the gap between the number of non-null expected parameters and the
number of times that the method actually makes sure that they are not
<tt class="docutils literal">null</tt>.</li>
</ul>
<p>Now, this is the time you might say &quot;well, you've just been reading
lousy Java code&quot;. I say, &quot;don't blame the messenger, this is because the
Java language is broken&quot;. I think that it's unrealistic that nullability
needs to be documented and checked for every parameter I add to a
method; I think it should be an inherent part of every programming
language to be explicit about optional values, because they are less
common.</p>
<div class="section" id="patching-the-java-language">
<h2>Patching the Java language</h2>
<p>One way to close this gap would be to introduce an <tt class="docutils literal">optional</tt> keyword
to Java. All parameters <em>without</em> this keyword would not be allowed to
be nullable. If they happened to be, a <tt class="docutils literal">NullPointerException</tt>
would get thrown.</p>
<p>For example, the call</p>
<div class="highlight"><pre><span class="n">describe</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;My description&quot;</span><span class="o">);</span>
</pre></div>
<p>with</p>
<div class="highlight"><pre><span class="kt">void</span> <span class="nf">describe</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">optional</span> <span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
<p>would throw an <cite>NullPointerException</cite> saying &quot;name is not  allowed to be null.&quot;</p>
<p>Obviously this would not be a backward compatible change and is never
gonna happen.</p>
</div>
<div class="section" id="a-workaround-for-a-broken-language">
<h2>A workaround for a broken language</h2>
<p>A couple of months ago I was recommended to have a look at <a class="reference external" href="https://code.google.com/p/guava-libraries/">Google
Guava</a> by <a class="reference external" href="https://twitter.com/rwalker">Robby Walker</a> at <a class="reference external" href="http://www.cueup.com">Cue</a>. I stumbled across the <a class="reference external" href="https://code.google.com/p/guava-libraries/wiki/UsingAndAvoidingNullExplained#Optional">Optional</a>
implementation, and at first completely misunderstood what is was. This
was a good thing, because I instead came up with what I wanted it to be;
an immutable non-nullable wrapper.</p>
<p>My misunderstanding got me thinking and earlier today I <a class="reference external" href="https://gist.github.com/JensRantil/6294289">sketched out</a>
an initial implementation of what I though would be able to solve some
of the gaps mentioned earlier in this article. Here's the full
implementation:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * An immutable object reference that may not be null.</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * This class has two purposes:</span>
<span class="cm"> * &lt;ul&gt;</span>
<span class="cm"> * &lt;li&gt;it adds a clearly documents the fact that a variable must not be</span>
<span class="cm"> * &lt;code&gt;null&lt;/code&gt;.&lt;/li&gt;</span>
<span class="cm"> * &lt;li&gt;it helps users to catch possible {@link NullPointerException}s as early</span>
<span class="cm"> * as possible in the value chain.&lt;/li&gt;</span>
<span class="cm"> * &lt;li&gt;it minimizes the risk of forgetting to check for null values in</span>
<span class="cm"> * constructors.&lt;/li&gt;</span>
<span class="cm"> * &lt;/ul&gt;</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * {@link NullPointerException}s are a misery in Java. Sadly, we have to live</span>
<span class="cm"> * with them and the best thing to deal with them is doing it as early as</span>
<span class="cm"> * possible in code. This class aims to help you with this.</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * A note on immutability: This class i immutable/final because is keeps</span>
<span class="cm"> * hashCode and equals methods to always return the same result throughout the</span>
<span class="cm"> * life cycle of an instance. This makes is possible to have</span>
<span class="cm"> * {@link NonNullable}s in {@link Map}s and {@link Set}s etc.</span>
<span class="cm"> * &lt;/p&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @author Jens Rantil &lt;jens.rantil@gmail.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * @param &lt;V&gt; the type of the real value to hold</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">NonNullable</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * The real value that this class wraps.</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Contruct a {@link NonNullable} immutable.</span>
<span class="cm">     * @param initialValue the actual value. Must (duh!) be non-null.</span>
<span class="cm">     * @throws NullPointerException if initialValue is null.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">NonNullable</span><span class="o">(</span><span class="n">V</span> <span class="n">initialValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">initialValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">(</span><span class="s">&quot;Must not be null: &quot;</span> <span class="o">+</span> <span class="n">initialValue</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">initialValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the actual non-null value.</span>
<span class="cm">     * @return value of type V. Never null.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns the (unmodified) {@link String} representation of the current</span>
<span class="cm">     * value.</span>
<span class="cm">     *</span>
<span class="cm">     * @return a string.</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns a hash code value for the wrapped value object.</span>
<span class="cm">     * @see java.lang.Object#hashCode()</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Indicates whether some other object is &quot;equal to&quot; the wrapped value</span>
<span class="cm">     * object.</span>
<span class="cm">     * @see java.lang.Object#equals(java.lang.Object)</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
<p>The class makes it possible to document/infer non-nullability by type.
It also makes it possible to quickly catch most of the invalid <tt class="docutils literal">null</tt>
values early on since they an exception is thrown in its exception.</p>
<p>The class obviously has some limitations:</p>
<ul class="simple">
<li>A <tt class="docutils literal">NonNullable</tt> instance can too be null. However, I still think the
advantages outweighs the disadvantages.</li>
<li>It can be slightly more cumbersome to extract the value from a
<tt class="docutils literal">NonNullable</tt> as you need to use the <tt class="docutils literal">get()</tt> method.</li>
<li>Instantiation of <tt class="docutils literal">NonNullable</tt> can be slow. This is mostly a guess,
though.</li>
</ul>
</div>
<div class="section" id="additional-notes">
<h2>Additional notes</h2>
<p>The <a class="reference external" href="http://www.haskell.org">Haskell</a> programming language has <a class="reference external" href="https://en.wikipedia.org/wiki/Monad_(functional_programming)#The_Maybe_monad">the Maybe monad</a> that handles
this issue precisely the way I'd like other programming languages to do.</p>
<p><em>What do you think? Is this something that could be useful? Is null
even an issue in Java? Please comment below.</em></p>
</div>


		<div id="article_meta">
							Category:
					<a href="http://jensrantil.github.io/category/misc.html">misc</a>
										<br />Tags:
									<a href="http://jensrantil.github.io/tag/java.html">java</a>
									<a href="http://jensrantil.github.io/tag/programming.html">programming</a>
									</div>
	</article>

	<div class="donations">
		Dude, did you like this blog post? Feel free to
		drop me some bitcoins on
		<a href="bitcoin:1Q79HGDF3ZjfCwXLAW6e7gX4DeDu2GtZ7v">1Q79HGDF3ZjfCwXLAW6e7gX4DeDu2GtZ7v</a>.
	</div>

	<footer>
		<a href="http://jensrantil.github.io/" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
	</footer>

		<div id="comments">
		<h2>Comments</h2>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_identifier = "javas-missing-optional-keyword-and-the-issues-of-null.html";
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://jensrantil.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view <a href="http://disqus.com/?ref_noscript">comments</a>.</noscript>
	</div>
	
	</section>

	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-40929103-1");
			pageTracker._trackPageview();
		} catch(err) {}</script>
</body>
</html>